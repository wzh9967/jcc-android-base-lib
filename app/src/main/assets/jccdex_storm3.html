<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script type="text/javascript" src="./utils.js"></script>
<script type="text/javascript" src="./fst.min.js"></script>
<script>
     function connectWebViewJavascriptBridge(callback) {
        if (window.WebViewJavascriptBridge) {
            callback(WebViewJavascriptBridge)
        } else {
            document.addEventListener(
                'WebViewJavascriptBridgeReady',
                function () {
                    callback(WebViewJavascriptBridge)
                },
                false
            );
        }
    }

    connectWebViewJavascriptBridge(function (bridge) {

        bridge.registerHandler("init", function (node, responseCallback) {
            fstInstance = new transaction.fst_transaction(node)
            fstInstance.init((result) =>{
                if(result){
                    responseCallback(result);
                } else {
                    responseCallback(false);
                }
            })
        });

        bridge.registerHandler("initContract", function (data, responseCallback) {
            try {
                data = JSON.parse(data);
                fstErc20Instance = new transaction.fst_erc20_transaction(data.node,data.contract,data.address);
                fstErc20Instance.init();
            }catch(e){

            }
        });

        bridge.registerHandler("createWallet", function (data, responseCallback) {
            var wallet;
            try {
                wallet = fstInstance.createWallet();
            } catch (e) {
                wallet = null;
            }
            responseCallback(toJsonString(wallet));
        });

        bridge.registerHandler("getGasPrice", async function (data, responseCallback) {
            var GasPrice;
            try {
                GasPrice = await fstInstance.getGasPrice();
            } catch (e) {
                GasPrice.err = e;
            }
            responseCallback(GasPrice);
        });

        bridge.registerHandler("getErc20Balance", async function (data, responseCallback) {
            var balance;
            try {
                balance = await fstErc20Instance.getErc20Balance(data.address);
            } catch (e) {
                balance.err = e;
            }
            responseCallback(balance);
        });


        bridge.registerHandler("sendErc20Transaction", async function (data, responseCallback) {
            var hash;
            try {
                var txData = await fstErc20Instance.SignErc20Transaction(data);
                hash = await fstErc20Instance.sendErc20Transaction(txData,data.secret);
            } catch (e) {
                hash.err = e;
            }
            responseCallback(hash);
        });

        bridge.registerHandler("getTransactionReceipt", async function (hash, responseCallback) {
            var result;
            try {
                 result = await fstInstance.getTransactionReceipt(hash);
            } catch (e) {
                result.err = e;
            }
            responseCallback(result);
        });


        bridge.registerHandler("getTransactionDetail", async function (hash, responseCallback) {
            var result;
            try {
                 result = await fstInstance.getTransactionDetail(hash);
            } catch (e) {
                result.err = e;
            }
            responseCallback(result);
        });

        bridge.registerHandler("SignTransaction", async function (data, responseCallback) {
            var raw;
            try {
                raw = await fstInstance.SignTransaction(data);
            } catch (e) {
                raw.err = e;
            }
            responseCallback(raw);
        });


        bridge.registerHandler("sendTransaction", async function (data, responseCallback) {
            var hash;
            try {
                var raw = await fstInstance.SignTransaction(data);
                hash = await fstInstance.sendtransaction(raw);
            } catch (e) {
                hash.err = e;
            }
            responseCallback(hash);
        });


        bridge.registerHandler("getBalance", async function (data, responseCallback) {
            var balance;
            try {
                balance= await fstInstance.getBalance(data.address);
            } catch (e) {
                balance.err = e;
            }
            responseCallback(balance);
        });


        bridge.registerHandler("toIban", function (data, responseCallback) {
            var Iban;
            try {
                Iban= fstInstance.toIban(data.address);
            } catch (e) {
                Iban.err = e;
            }
            responseCallback(Iban);
        });

        bridge.registerHandler("fromIban",  function (Iban, responseCallback) {
            var Iban;
            try {
                Iban= fstInstance.fromIban(Iban);
            } catch (e) {
                Iban.err = e;
            }
            responseCallback(Iban);
        });


        bridge.registerHandler("importWords", function (words, responseCallback) {
            var wallet;
            try {
                wallet= fstInstance.importWords(words,password);
            } catch (e) {
                wallet.err = e;
            }
            responseCallback(wallet);
        });

        bridge.registerHandler("isValidSecret", function (secret, responseCallback) {
            var valid;
            try {
                valid= fstInstance.isValidSecret(secret);
            } catch (e) {
                valid = false;
            }
            responseCallback(valid);
        });

        bridge.registerHandler("isValidAddress", function (address, responseCallback) {
            var valid;
            try {
                valid= fstInstance.isValidSecret(address);
            } catch (e) {
                valid = false;
            }
            responseCallback(valid);
        });


        bridge.registerHandler("importSecret", function (data, responseCallback) {
            var wallet;
            try {
                wallet= fstInstance.importSecret(data.secret,data.password);
            } catch (e) {
                wallet.err = err;
            }
            responseCallback(wallet);
        });


    })

</script>
</body>
</html>